{% extends "calc/base.html" %}

{% block style %}
<style>
    .item-container{
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 1px solid #000;
        width: 90%;
        margin-left: 10%;
        padding: 10px;
    }
    .item{
        display: flex;
        flex-direction: row;
       
        margin: 5px;
    }
    label{
        margin: 0;
        text-decoration: underline;
    }
    .ROW{
        margin-left: 5px;
        margin-right: 5px;
    }
    table, th, td {
    border: 1px solid black;
    }
    td{
        text-align: center;
    }
    p{
        margin: 5px;
    }
</style>
{% endblock %}

{% block body %}



    
    <h1>Todays arrivals: {{today}}</h1>
    
    <div class="item-container">
       
<table style="width:100%">
  <tr>
    <th>Name</th>
    <th>Membership</th>
    <th>VIP Level</th>
    <th>Date of Arrival</th>
    <th>Amenities</th>
    <th>Date</th>
  </tr>
  {% for d in data %}
  <tr>
    <td><p>{{d.name}}</p></td>
    <td >{{d.membership}}</td>
    <td>{{d.vip_level}}</td>
    <td>{{d.date}}</td>
    <td class="amenities">{{d.fruit_amenity}}, {{ d.drink_amenity}}, {{d.dessert_amenity}}</td>
    <td>{{d.arrival_date}}</td>
  </tr>
  {% endfor %}
  <tr>
    <td>February</td>
    <td style="text-align:right">$80</td>
  </tr>
</table>


</div>
<div class="total">
    <ul id="total">
        <li></li>
    </ul>
</div>
<script>
    const amenitiesEl = document.getElementsByClassName('amenities')
    
   // need to import jason and compare arrival name with amenities 
   // and input it back to page as combined + total  
    
    let arr = []
    for (let item of amenitiesEl) {
    //console.log(item.innerText)
    let nArr = item.innerText.split(',')
        arr.push(nArr)
    }
    
    arr.forEach(el => {

        console.log(el)
    })
    
    const JSON_data = ('/json_data')
    GetData(JSON_data)
    async function GetData(url) {
        const res = await fetch(url)
        const data = await res.json()
 
 
        //console.log(data)

        // NEED to look in this as returns double values 
let coun = 0
let counM = 0
let counL = 0
let desC = 0  
let desB = 0
let desM = 0
        data.forEach(e => {
            
            //var date = new Date().toLocaleDateString()
            //var currentDate = date.getFullYear() + '-' + date.getrMonth() + '-' + date.getDate()
            
            //console.log(e.date,' ',e.arrival_date)

            if (e.arrival_date === e.date){
                //console.log(e.name, '+', e.fruit_amenity, '+', e.arrival_date )
                //console.log(e)
                let numCount = {key: {type:'none',
                                        num: 0},
                                des: {Dtype: 'none',
                                        Dnum: 0}
                                    }
                numCount.key.type = e.fruit_amenity
                numCount.key.num= e.num_fruit
                numCount.des.Dtype = e.dessert_amenity
                numCount.des.Dnum = e.num_dessrt
                //numCount.num = e.num_fruit
                
                for(var key in numCount){
                    //console.log(key+ ':' + numCount[key])
                    if ( e.fruit_amenity == 'Small fruit'){
                        //var Ccoun = 0
                        coun =  coun + numCount.key.num
                    } else if (e.fruit_amenity == 'Midium fruit'){
                        counM = counM + numCount.key.num

                    }else if (e.fruit_amenity == 'Large fruit'){
                        counL = counL + numCount.key.num

                    }

                }
               
                for (var key in numCount){
                     if (e.dessert_amenity == 'Chocolate truffle'){
                        desC = desC + numCount.des.Dnum
                        
                    }else if(e.dessert_amenity == 'Baklava'){
                        
                        desB = desB + numCount.des.Dnum
                        
                    }else if(e.dessert_amenity == 'Macaroons 4pcs'){
                       
                        desM = desM + numCount.des.Dnum
                    }
                     //console.log(e.dessert_amenity, '-', numCount.des)
                }
                 




                console.log(numCount)
            }
            
        });
                        const ulEl = document.getElementById('total')
                var liEl = document.createElement('li')
                liEl.innerHTML = `<div> Small Fruit total : ${coun / 2} <br><br>
                                        Midium Fruit total : ${counM / 2}<br><br>
                                        Large Fruit total : ${counL / 2}<br><br>
                                        Chocolaet traffles : ${desC / 2}<br><br>
                                        Baklava total : ${desB / 2}<br><br>
                                        Macaroons 4pcs total: ${desM / 2}<br><br>
                                    </div>`
                
                                  
                ulEl.appendChild(liEl)
        //console.log(coun, '-', counM,' ', counL)

    }
    const LiElments = document.getElementById('total')
    for(let i = 0; i < LiElments.length; i++){
        //console.log(LiElments[i])
        if( LiElments[i].innerHTML == 'undefined'){
            LiElments[i].style.display = 'none'
        }
    }


</script>
{% endblock %}